<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Parameter estimation on empirical data · ADDM.jl</title><meta name="title" content="Parameter estimation on empirical data · ADDM.jl"/><meta property="og:title" content="Parameter estimation on empirical data · ADDM.jl"/><meta property="twitter:title" content="Parameter estimation on empirical data · ADDM.jl"/><meta name="description" content="Documentation for ADDM.jl."/><meta property="og:description" content="Documentation for ADDM.jl."/><meta property="twitter:description" content="Documentation for ADDM.jl."/><script data-outdated-warner src="../../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../search_index.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../../"><img src="../../assets/logo.png" alt="ADDM.jl logo"/></a><div class="docs-package-name"><span class="docs-autofit"><a href="../../">ADDM.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../../">Home</a></li><li><span class="tocitem">Tutorials</span><ul><li><a class="tocitem" href="../01_getting_started/">Getting started with ADDM.jl</a></li><li class="is-active"><a class="tocitem" href>Parameter estimation on empirical data</a><ul class="internal"><li><a class="tocitem" href="#Load-packages"><span>Load packages</span></a></li><li><a class="tocitem" href="#Read-in-data"><span>Read in data</span></a></li><li><a class="tocitem" href="#Grid-search"><span>Grid search</span></a></li></ul></li><li><a class="tocitem" href="../04_model_comparison/">Model comparison</a></li></ul></li><li><a class="tocitem" href="../../apireference/">API Reference</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Tutorials</a></li><li class="is-active"><a href>Parameter estimation on empirical data</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Parameter estimation on empirical data</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/aDDM-Toolbox/ADDM.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/aDDM-Toolbox/ADDM.jl/blob/main/docs/src/tutorials/03_empirical_data.md" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="Parameter-estimation-on-empirical-data"><a class="docs-heading-anchor" href="#Parameter-estimation-on-empirical-data">Parameter estimation on empirical data</a><a id="Parameter-estimation-on-empirical-data-1"></a><a class="docs-heading-anchor-permalink" href="#Parameter-estimation-on-empirical-data" title="Permalink"></a></h1><p><a href="https://addm-toolbox.github.io/ADDM.jl/dev/tutorials/01_getting_started/">Previously</a>, we recovered known parameters on simulated data. But often, we do not know these parameters and instead work with empirical data. In this tutorial we will walk through how to organize empirical data to use the toolbox functions.</p><h2 id="Load-packages"><a class="docs-heading-anchor" href="#Load-packages">Load packages</a><a id="Load-packages-1"></a><a class="docs-heading-anchor-permalink" href="#Load-packages" title="Permalink"></a></h2><p>We begin with loading the modules for the tutorial.</p><pre><code class="language-julia-repl hljs" style="display:block;">julia&gt; using ADDM, CSV, DataFrames, StatsPlots</code><code class="nohighlight hljs ansi" style="display:block;"></code></pre><h2 id="Read-in-data"><a class="docs-heading-anchor" href="#Read-in-data">Read in data</a><a id="Read-in-data-1"></a><a class="docs-heading-anchor-permalink" href="#Read-in-data" title="Permalink"></a></h2><p>Data in this tutorial are from 10 subjects in <a href="https://www.nature.com/articles/nn.2635">Kraijbich et al (2010)</a>. We will use the built-in data loading function <code>ADDM.load_data_from_csv</code> that expects a behavioral file with columns <code>parcode, trial, rt, choice, item_left, item_right</code> and fixations file with columns <code>parcode, trial, fix_item, fix_time</code>.</p><p>If your data is not organized in this way you could either preprocess it so it does or you can read in the data however you want and reshape it with Julia to ensure it is organized as a dictionary of <code>Trial</code> objects <em>indexed by subject/parcode</em>. A <code>Trial</code> looks like</p><pre><code class="nohighlight hljs">ADDM.Trial(1, 1474.0, -5, 5, Number[3, 0, 1, 0, 2, 0], Number[270.0, 42.0, 246.0, 62.0, 558.0, 296.0], #undef, #undef, #undef)</code></pre><p>where the first element is choice (-1 for left, +1 for right), second element is response time in ms, third is value of left option, fourth is value of right option. Fixation data is specified in the fourth and fifth elements as fixation location (1 for left, 2 for right) and fixation duration (in ms) respectively. The remaning elements currently set to <code>#undef</code> can be ignored. These are for debugging/examining the relative decision value when simulating trials.</p><pre><code class="nohighlight hljs ansi" style="display:block;"></code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; krajbich_data = ADDM.load_data_from_csv(data_path * &quot;Krajbich2010_behavior.csv&quot;, data_path * &quot;Krajbich2010_fixations.csv&quot;)</code><code class="nohighlight hljs ansi" style="display:block;">Dict{String, Vector{ADDM.Trial}} with 10 entries:
  &quot;20&quot; =&gt; [Trial(-1, 1991, 4, 2, Number[1, 2, 1], Number[339, 679, 680], #undef…
  &quot;10&quot; =&gt; [Trial(-1, 3808, 4, 2, Number[1, 2, 1, 2, 1, 2, 1], Number[98, 426, 3…
  &quot;17&quot; =&gt; [Trial(-1, 1191, 0, 0, Number[1, 2], Number[340, 638], #undef, #undef…
  &quot;19&quot; =&gt; [Trial(1, 1449, 7, 5, Number[1, 2, 1], Number[258, 677, 99], #undef, …
  &quot;23&quot; =&gt; [Trial(-1, 6078, 6, 4, Number[1, 2, 1], Number[2601, 1435, 1675], #un…
  &quot;22&quot; =&gt; [Trial(1, 2882, 6, 2, Number[2, 1, 2, 1, 2], Number[259, 797, 595, 57…
  &quot;16&quot; =&gt; [Trial(1, 1251, 5, 5, Number[1, 2], Number[275, 660], #undef, #undef,…
  &quot;18&quot; =&gt; [Trial(-1, 13456, 2, 0, Number[1, 2, 1, 2, 1, 2, 1], Number[637, 2691…
  &quot;13&quot; =&gt; [Trial(1, 3848, 1, 2, Number[1, 2, 1, 2], Number[1036, 757, 997, 757]…
  &quot;14&quot; =&gt; [Trial(-1, 2234, 2, 0, Number[2, 1], Number[399, 737], #undef, #undef…</code></pre><div class="admonition is-info"><header class="admonition-header">Note</header><div class="admonition-body"><p>Note the organization of data. It is a dictionary where the keys are subject identifiers and values are arrays of <code>ADDM.Trial</code> objects.</p></div></div><h2 id="Grid-search"><a class="docs-heading-anchor" href="#Grid-search">Grid search</a><a id="Grid-search-1"></a><a class="docs-heading-anchor-permalink" href="#Grid-search" title="Permalink"></a></h2><p>Now that we have loaded our data, we define the parameter space over which we&#39;ll search to determine the best combination for each subject. We&#39;ll use a grid of 64 parameter combinations with <code>d</code> in {0.0001, 0.00015, 0.0002, 0.00025}, <code>μ</code> in {80, 100, 120, 140}, <code>θ</code> in {0.3, 0.5, 0.7, 0.9}  and <code>σ = d*μ</code>   </p><pre><code class="language-julia-repl hljs" style="display:block;">julia&gt; fn = data_path * &quot;Krajbich_grid.csv&quot;;</code><code class="nohighlight hljs ansi" style="display:block;"></code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; tmp = DataFrame(CSV.File(fn, delim=&quot;,&quot;));</code><code class="nohighlight hljs ansi" style="display:block;"></code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; param_grid = NamedTuple.(eachrow(tmp))</code><code class="nohighlight hljs ansi" style="display:block;">64-element Vector{NamedTuple{(:d, :sigma, :theta), Tuple{Float64, Float64, Float64}}}:
 (d = 0.0001, sigma = 0.008, theta = 0.3)
 (d = 0.00015, sigma = 0.012, theta = 0.3)
 (d = 0.0002, sigma = 0.016, theta = 0.3)
 (d = 0.00025, sigma = 0.02, theta = 0.3)
 (d = 0.0001, sigma = 0.01, theta = 0.3)
 (d = 0.00015, sigma = 0.015, theta = 0.3)
 (d = 0.0002, sigma = 0.02, theta = 0.3)
 (d = 0.00025, sigma = 0.025, theta = 0.3)
 (d = 0.0001, sigma = 0.012, theta = 0.3)
 (d = 0.00015, sigma = 0.018, theta = 0.3)
 ⋮
 (d = 0.00025, sigma = 0.025, theta = 0.9)
 (d = 0.0001, sigma = 0.012, theta = 0.9)
 (d = 0.00015, sigma = 0.018, theta = 0.9)
 (d = 0.0002, sigma = 0.024, theta = 0.9)
 (d = 0.00025, sigma = 0.03, theta = 0.9)
 (d = 0.0001, sigma = 0.014, theta = 0.9)
 (d = 0.00015, sigma = 0.021, theta = 0.9)
 (d = 0.0002, sigma = 0.028, theta = 0.9)
 (d = 0.00025, sigma = 0.035, theta = 0.9)</code></pre><p>Since the dataset contains multiple subjects and we want to compute the best parameters for each subject, we loop through each subject&#39;s dataset and collect the estimated parameters in a single data frame for each subject. This is sufficiently fast for this small example but see the parallelization <a href="https://addm-toolbox.github.io/ADDM.jl/dev/tutorials/06_parallelization.md/">tutorial</a> on how to do this with larger datasets and parameter spaces.</p><pre><code class="language-julia-repl hljs" style="display:block;">julia&gt; all_nlls = DataFrame();</code><code class="nohighlight hljs ansi" style="display:block;"></code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; subj_mles = Dict();</code><code class="nohighlight hljs ansi" style="display:block;"></code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; for k in keys(krajbich_data)
         cur_subj_data = krajbich_data[k]
       
         output = ADDM.grid_search(cur_subj_data, param_grid, ADDM.aDDM_get_trial_likelihood, Dict(:η=&gt;0.0, :barrier=&gt;1, :decay=&gt;0, :nonDecisionTime=&gt;0, :bias=&gt;0.0), return_grid_nlls = true)
       
         subj_mles[k] = output[:mle]
       
         # Add subject id
         output[:grid_nlls][!, &quot;parcode&quot;] .= k
       
         append!(all_nlls, output[:grid_nlls])
       
       end;</code><code class="nohighlight hljs ansi" style="display:block;"></code></pre><p>To view best parameter estimates for each subject we can look at the <code>subj_mles</code> data frame, to which the output of <code>ADDM.grid_search</code> was pushed for each subject.</p><pre><code class="language-julia-repl hljs" style="display:block;">julia&gt; subj_mles</code><code class="nohighlight hljs ansi" style="display:block;">Dict{Any, Any} with 10 entries:
  &quot;20&quot; =&gt; Dict{Symbol, Real}(:barrier=&gt;1, :decay=&gt;0, :timeStep=&gt;10.0, :nonDecis…
  &quot;10&quot; =&gt; Dict{Symbol, Real}(:barrier=&gt;1, :decay=&gt;0, :timeStep=&gt;10.0, :nonDecis…
  &quot;17&quot; =&gt; Dict{Symbol, Real}(:barrier=&gt;1, :decay=&gt;0, :timeStep=&gt;10.0, :nonDecis…
  &quot;19&quot; =&gt; Dict{Symbol, Real}(:barrier=&gt;1, :decay=&gt;0, :timeStep=&gt;10.0, :nonDecis…
  &quot;23&quot; =&gt; Dict{Symbol, Real}(:barrier=&gt;1, :decay=&gt;0, :timeStep=&gt;10.0, :nonDecis…
  &quot;22&quot; =&gt; Dict{Symbol, Real}(:barrier=&gt;1, :decay=&gt;0, :timeStep=&gt;10.0, :nonDecis…
  &quot;16&quot; =&gt; Dict{Symbol, Real}(:barrier=&gt;1, :decay=&gt;0, :timeStep=&gt;10.0, :nonDecis…
  &quot;18&quot; =&gt; Dict{Symbol, Real}(:barrier=&gt;1, :decay=&gt;0, :timeStep=&gt;10.0, :nonDecis…
  &quot;13&quot; =&gt; Dict{Symbol, Real}(:barrier=&gt;1, :decay=&gt;0, :timeStep=&gt;10.0, :nonDecis…
  &quot;14&quot; =&gt; Dict{Symbol, Real}(:barrier=&gt;1, :decay=&gt;0, :timeStep=&gt;10.0, :nonDecis…</code></pre><p>As an example visualization below we plot variability in the negative log likelihoods for each parameter combination for each subject. This is not a plot that is typically used for any model diagnostics. The intention is only to show that the likelihood function did indeed compute different values for different parameter combinations.</p><pre><code class="language-julia-repl hljs" style="display:block;">julia&gt; wide_nll_df = unstack(all_nlls, :parcode, :nll);</code><code class="nohighlight hljs ansi" style="display:block;"></code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; select!(wide_nll_df, Not([:d, :sigma, :theta]));</code><code class="nohighlight hljs ansi" style="display:block;"></code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; colnames = names(wide_nll_df);</code><code class="nohighlight hljs ansi" style="display:block;"></code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; colnames = string.(&quot;subj-&quot;, colnames);</code><code class="nohighlight hljs ansi" style="display:block;"></code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; N = length(colnames);</code><code class="nohighlight hljs ansi" style="display:block;"></code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; @df wide_nll_df histogram(cols(1:N); layout=grid(2,5), legend=false, title=permutedims(colnames), frame=:box, titlefontsize=11, c=:blues, bins = 20, size=(1800,1000), xrotation = 45)</code><code class="nohighlight hljs ansi" style="display:block;">Plot{Plots.GRBackend() n=10}</code><code class="nohighlight hljs ansi" style="display:block;"></code></pre><p><img src="../plot_2_1.png" alt="plot"/></p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../01_getting_started/">« Getting started with ADDM.jl</a><a class="docs-footer-nextpage" href="../04_model_comparison/">Model comparison »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.4.0 on <span class="colophon-date" title="Tuesday 30 April 2024 21:29">Tuesday 30 April 2024</span>. Using Julia version 1.9.4.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
